{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\loveText.js"],"names":["cc","Class","extends","Component","properties","textBg","SpriteFrame","loveTextJson","JsonAsset","mainText","Label","numberLabel","winEffect","type","AudioClip","default","clickEffect","popWindow","node","position","v2","getComponent","Sprite","spriteFrame","randLetter","playLoveText","playWinEffect","randNumber","Math","floor","random","length","fullText","json","textData","randSeq","randText","string","showHasPlayText","sys","localStorage","setItem","seqArray","JSON","parse","getItem","num","Array","i","stringify","textAppear","lastText","TextClose","audioEngine","playEffect","playClickEffect"],"mappings":"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","file":"loveText.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        textBg: [cc.SpriteFrame],\r\n        loveTextJson: cc.JsonAsset,\r\n        mainText: cc.Label,\r\n        numberLabel: cc.Label,\r\n        winEffect: {\r\n            type: cc.AudioClip,\r\n            default: null,\r\n        },\r\n        clickEffect: {\r\n            type: cc.AudioClip,\r\n            default: null,\r\n        },\r\n    },\r\n\r\n    popWindow() {\r\n        // 用来弹出文本框\r\n        this.node.position = cc.v2(0, 20); // 这里是相对父节点的坐标系\r\n        this.node.getComponent(cc.Sprite).spriteFrame = this.randLetter();\r\n        this.playLoveText();\r\n        this.playWinEffect();\r\n    },\r\n\r\n    randLetter() {\r\n        // 随机选择信纸\r\n        let randNumber = Math.floor(Math.random() * this.textBg.length);\r\n        return this.textBg[randNumber];\r\n    },\r\n\r\n    playLoveText() {\r\n        this.fullText = this.loveTextJson.json.textData; // 得到全部的文本\r\n        let randSeq = Math.floor(Math.random() * this.fullText.length);\r\n        let randText = this.fullText[randSeq];\r\n        this.mainText.string = randText;\r\n        this.showHasPlayText(randSeq); // 用来显示语句数量标签\r\n        cc.sys.localStorage.setItem(\"lastText\", randText);\r\n    },\r\n\r\n    showHasPlayText(randSeq) {\r\n        let seqArray = JSON.parse(cc.sys.localStorage.getItem(\"saveArray\"));\r\n        let num = 0;\r\n        if (seqArray == null) {\r\n            seqArray = new Array(this.fullText.length);\r\n        }\r\n        seqArray[randSeq] = 1;\r\n\r\n        for (let i=0;i<seqArray.length;i++) {\r\n            if (seqArray[i] == 1) {\r\n                num++;\r\n            }\r\n        }\r\n        this.numberLabel.string = num + '/' + this.fullText.length;\r\n        cc.sys.localStorage.setItem(\"saveArray\", JSON.stringify(seqArray));\r\n    },\r\n\r\n    /*getText(){\r\n        let textData = JSON.parse(cc.sys.localStorage.getItem(\"loveText\")); \r\n        if( textData == null){\r\n            cc.sys.localStorage.setItem(\"loveText\",JSON.stringify(this.loveTextJson));\r\n        }\r\n\r\n        return textData.json;\r\n\r\n    },*/\r\n\r\n    textAppear() {\r\n        let lastText = cc.sys.localStorage.getItem(\"lastText\");\r\n        if (lastText == null) {\r\n            lastText = \"还没有解锁过情话哦。\";\r\n        }\r\n        this.mainText.string = lastText;\r\n        this.node.position = cc.v2(0, 20);\r\n    },\r\n\r\n    TextClose() {\r\n        // 这个函数实现“假”关闭文本框，因为只是将文本框移出可见范围\r\n        this.node.position = cc.v2(1500, 0);\r\n    },\r\n\r\n    playWinEffect() {\r\n        cc.audioEngine.playEffect(this.winEffect);\r\n    },\r\n    playClickEffect() {\r\n        cc.audioEngine.playEffect(this.clickEffect);\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}